<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù…Ù†ÙŠÙˆ ÙˆØ±Ø¯ ÙƒØ§ÙÙŠÙ‡</title>
  <link rel="icon" href="photos/logo.png" type="image/x-icon">
  <meta name="theme-color" content="#551665">

  <style>
    /* ØªØ­Ø³ÙŠÙ†Ø§Øª CSS Ù„Ù„Ø£Ø¯Ø§Ø¡ */
    body { margin: 0; padding-bottom: 80px; font-family: sans-serif; background: #fff9ec; }
    .page-frame { border: 4px solid #551665; border-radius: 15px; margin: 5px; background: #fff; min-height: 100vh; }
    
    .header { 
      background: #551665; color: white; min-height: 150px; 
      display: flex; align-items: center; justify-content: center; 
      position: relative; text-align: center; padding: 10px;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„ÙŠÙƒÙˆÙ† Ø£Ø®Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬ */
    .logo-img, .logo-text { position: absolute; width: 80%; transition: opacity 0.5s; }
    .hidden { opacity: 0; visibility: hidden; }
    .visible { opacity: 1; visibility: visible; }

    .search-bar { margin: 10px; display: flex; background: #eee; border-radius: 10px; padding: 5px 15px; }
    .search-bar input { flex: 1; border: none; background: transparent; padding: 10px; font-size: 16px; outline: none; }

    .categories-grid { 
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; 
      padding: 10px; sticky; top: 0; z-index: 10; background: #fff9ec;
    }
    .category { background: #e6e3da; border: none; padding: 8px 2px; border-radius: 8px; font-size: 11px; cursor: pointer; }
    .category.selected { background: #551665; color: white; }

    .food-card { 
      margin: 10px; background: white; border-radius: 12px; 
      box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; flex-direction: column;
    }
    .food-card img { width: 100%; height: 200px; object-fit: cover; border-radius: 12px 12px 0 0; background: #f0f0f0; }
    .food-info { padding: 12px; }
    .food-info h4 { margin: 0; display: flex; justify-content: space-between; font-size: 15px; }
    
    .bottom-nav {
      position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%);
      width: 90%; background: #551665; display: flex; justify-content: space-around;
      padding: 10px 0; border-radius: 50px; z-index: 1000;
    }
    .bottom-nav a { color: white; text-decoration: none; font-size: 20px; text-align: center; }
    .bottom-nav span { display: block; font-size: 10px; }

    #loading-state { text-align: center; padding: 20px; font-weight: bold; color: #551665; }
  </style>
</head>
<body>

<div class="page-frame">
  <div class="header" id="header-box">
    <img src="photos/logo.png" alt="Logo" class="logo-img visible" id="logo-img">
    <div class="logo-text hidden" id="logo-txt">Ù…Ø·Ø¹Ù… ÙˆÙƒØ§ÙÙŠÙ‡ ÙˆØ±Ø¯<br>Ø·Ø¹Ù… ØµØ­ÙŠ ÙˆØ·Ø¨ÙŠØ¹ÙŠ</div>
  </div>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Ø¨Ø­Ø« Ø¹Ù† ÙˆØ¬Ø¨Ø© Ø£Ùˆ Ø³Ø¹Ø±..." onkeyup="debounceSearch()">
  </div>

  <div class="categories-grid" id="cat-grid">
    </div>

  <div id="loading-state">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„... ğŸŒ¸</div>
  <div id="food-list"></div>
</div>

<nav class="bottom-nav">
  <a href="fedback.html">ğŸ’¬<span>Ø¢Ø±Ø§Ø¦ÙƒÙ…</span></a>
  <a href="index.html">ğŸ <span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></a>
  <a href="map.html">ğŸ“<span>Ù…ÙˆÙ‚Ø¹Ù†Ø§</span></a>
</nav>

<script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwF6QRoxTgFhZiU1fkCIOkUiIsbnNfH5rRufLxz5bg8HhnCJcjs675LZI4gtarBFgRB/exec";
  let foodData = {};
  let timer;

  // 1. ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙˆØ§Ù„Ù†Øµ Ø¨Ø´ÙƒÙ„ Ø£Ø®Ù
  setInterval(() => {
    const img = document.getElementById('logo-img');
    const txt = document.getElementById('logo-txt');
    img.classList.toggle('hidden'); img.classList.toggle('visible');
    txt.classList.toggle('hidden'); txt.classList.toggle('visible');
  }, 5000);

  // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø°ÙƒÙŠ
  async function init() {
    const cached = localStorage.getItem('menu_data');
    if (cached) {
      foodData = JSON.parse(cached);
      setupCategories();
      render('Ø§Ù„Ø§ÙØ·Ø§Ø±');
      document.getElementById('loading-state').style.display = 'none';
    }
    
    try {
      const res = await fetch(`${SCRIPT_URL}?action=read`);
      const rawData = await res.json();
      
      // ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ Ø£Ø³Ø±Ø¹ Ù„Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø©
      const organized = {};
      rawData.forEach(item => {
        if (!organized[item.category]) organized[item.category] = [];
        organized[item.category].push(item);
      });

      foodData = organized;
      localStorage.setItem('menu_data', JSON.stringify(organized));
      
      if (!cached) {
        setupCategories();
        render('Ø§Ù„Ø§ÙØ·Ø§Ø±');
        document.getElementById('loading-state').style.display = 'none';
      }
    } catch (e) {
      console.error("Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø¶Ø¹ÙŠÙ Ø¬Ø¯Ø§Ù‹");
    }
  }

  function setupCategories() {
    const grid = document.getElementById('cat-grid');
    const cats = Object.keys(foodData);
    grid.innerHTML = cats.map(c => `
      <button class="category ${c==='Ø§Ù„Ø§ÙØ·Ø§Ø±'?'selected':''}" onclick="filterCat(this, '${c}')">
        ${c}
      </button>
    `).join('');
  }

  // 3. Render Ø³Ø±ÙŠØ¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Strings Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† createElement
  function render(cat) {
    const container = document.getElementById('food-list');
    const items = foodData[cat] || [];
    
    container.innerHTML = items.map(item => `
      <div class="food-card">
        ${item.image ? `<img src="${item.image}" loading="lazy" alt="${item.name}">` : ''}
        <div class="food-info">
          <h4><span>${item.name}</span> <span style="color:#551665">${item.price}</span></h4>
          ${item.description ? `<p>${item.description}</p>` : ''}
        </div>
      </div>
    `).join('');
  }

  function filterCat(btn, cat) {
    document.querySelectorAll('.category').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    render(cat);
    window.scrollTo({top: 200, behavior: 'smooth'});
  }

  // 4. ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¨Ø­Ø« (Debounce) Ù„ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¶ØºØ·
  function debounceSearch() {
    clearTimeout(timer);
    timer = setTimeout(search, 300);
  }

  function search() {
    const q = document.getElementById('searchInput').value.toLowerCase();
    if(!q) { render('Ø§Ù„Ø§ÙØ·Ø§Ø±'); return; }

    const allItems = Object.values(foodData).flat();
    const filtered = allItems.filter(i => i.name.toLowerCase().includes(q) || i.price.toString().includes(q));
    
    const container = document.getElementById('food-list');
    container.innerHTML = filtered.map(item => `
      <div class="food-card">
        <div class="food-info"><h4>${item.name} <span>${item.price}</span></h4></div>
      </div>
    `).join('');
  }

  window.onload = init;
</script>
</body>
</html>
